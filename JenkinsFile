pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                // Explicitly restore packages for each project
                sh 'dotnet restore DevOps.sln'
                
                // Build with clearer output
                sh 'dotnet build DevOps.sln --configuration Release -p:Version=1.0.0 --no-restore'
            }
        }
        stage('Test') {
            steps {
                // Test specific test projects if needed
                sh 'dotnet test DevOps.sln --configuration Release --no-build --verbosity normal'
            }
        }
        stage('Publish') {
            steps {
                // Publish individual projects instead of solution
                sh '''
                mkdir -p .publish
                dotnet publish DevOps.sln \
                    --configuration Release \
                    --no-build \
                    -p:Version=1.0.0
                '''
            }
        }
    }

    post {
        always {
            echo 'Build , Test and Publish successfull'
        }
    }
}